<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Accelerometer Demo</title>

    <style>
      .indicatorDot {
        width: 200px; /* 50 */
        height: 200px;
        background-color: #ff0000;
        border-radius: 50%;
        position: fixed;
      }

      .spotDot {
        width: 50px;
        height: 50px;
        background-color: #000000;
        border-radius: 50%;
        position: fixed;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: "Noto Sans KR", sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
        /* justify-content: space-between; */
        /* align-items: center; */
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      .title {
        margin-top: 30vh;

        font-size: 3rem;
        text-align: center;
      }

      .author {
        margin-top: 30vh;
        font-size: 2rem;
        text-align: center;
        color: #333;
      }
    </style>

    <script>
      const indicatorDots = []; // 움직일 원들을 저장하는 배열
      const velocities = []; // 각 원의 속도 저장 (vx, vy)
      const updateRate = 1 / 60;

      // 기존 버튼으로 permission 얻기
      function getAccel() {
        DeviceMotionEvent.requestPermission().then((response) => {
          if (response == "granted") {
            window.addEventListener("deviceorientation", (event) => {
              const frontToBack = event.beta;
              const leftToRight = event.gamma;

              for (let i = 0; i < indicatorDots.length; i++) {
                const dot = indicatorDots[i];
                const velocity = velocities[i];

                // 속도 업데이트
                velocity.vx += leftToRight * updateRate * 2;
                velocity.vy += frontToBack * updateRate;

                // 현재 위치
                let rect = dot.getBoundingClientRect();
                let px = rect.left + velocity.vx * 0.5;
                let py = rect.top + velocity.vy * 0.5;

                // 화면 범위 제한
                px = Math.max(0, Math.min(window.innerWidth - 50, px));
                py = Math.max(0, Math.min(window.innerHeight - 50, py));

                // 속도 초기화 (벽 충돌 시 반사 아님, 정지)
                if (px <= 0 || px >= window.innerWidth - 50) velocity.vx = 0;
                if (py <= 0 || py >= window.innerHeight - 50) velocity.vy = 0;

                // 위치 적용
                dot.style.left = px + "px";
                dot.style.top = py + "px";

                // spot과 충돌 체크
                const spot = document.getElementsByClassName("spotDot")[0];
                checkCollision(dot, spot);
              }
            });
          }
        });
      }

      // 새 indicatorDot 생성 함수 (터치 이벤트용)
      document.addEventListener("touchstart", function (event) {
        const touch = event.touches[0];

        const newDot = document.createElement("div");
        newDot.className = "indicatorDot";
        newDot.style.left = touch.clientX - 25 + "px";
        newDot.style.top = touch.clientY - 25 + "px";

        document.body.appendChild(newDot);

        // 배열에 추가
        indicatorDots.push(newDot);
        velocities.push({ vx: 0, vy: 0 });
      });

      // 충돌 감지
      function checkCollision(dot, spot) {
        const dotRect = dot.getBoundingClientRect();
        const spotRect = spot.getBoundingClientRect();

        const isColliding =
          dotRect.left < spotRect.right &&
          dotRect.right > spotRect.left &&
          dotRect.top < spotRect.bottom &&
          dotRect.bottom > spotRect.top;

        if (isColliding) {
          window.location.href = "intro_1.html";
        }
      }
    </script>
  </head>
  <body style="background-color: beige">
    <button id="accelPermsButton" style="height: 50px" onclick="getAccel()">
      <h1>Get Accelerometer Permissions</h1>
    </button>
    <div class="indicatorDot" style="left: 30%; top: 30%"></div>
    <div class="spotDot" style="left: 48.5vw; top: 52vh"></div>
    <div class="title"><a href="journal.html">의식저널</a></div>

    <div class="author">
      <a
        href="https://www.instagram.com/suhyouri"
        target="_blank"
        rel="noopener noreferrer"
        >서유리</a
      >
    </div>
  </body>
</html>
